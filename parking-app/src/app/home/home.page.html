<!-- home/home.page.html -->
<ion-header class="ion-no-border">
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>Find Parking</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="openNotifications()">
        <ion-icon name="notifications"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <!-- Location Header -->
  <div class="location-card">
    <div class="flex-between">
      <div>
        <p class="text-muted">Current Location</p>
        <h3>{{ currentLocation?.address || 'Fetching...' }}</h3>
      </div>
      <ion-button fill="clear" (click)="refetchLocation()">
        <ion-icon name="refresh"></ion-icon>
      </ion-button>
    </div>
  </div>

  <!-- Search Bar -->
  <ion-searchbar 
    [(ngModel)]="searchText" 
    (ionChange)="onSearchChange()"
    placeholder="Search parking by area or landmark"
    debounce="500"
  ></ion-searchbar>

  <!-- Filter Buttons -->
  <div class="filter-scroll">
    <ion-button 
      *ngFor="let filter of filters"
      [fill]="selectedFilter === filter ? 'solid' : 'outline'"
      (click)="selectFilter(filter)"
      size="small"
    >
      {{ filter }}
    </ion-button>
  </div>

  <!-- Active Booking Banner -->
  <div *ngIf="activeBooking" class="active-booking-banner">
    <div class="flex-between">
      <div>
        <p class="text-small">Active Booking</p>
        <h4>{{ activeBooking.parking_space.title }}</h4>
        <p class="text-small text-muted">{{ activeBooking.status | titlecase }}</p>
      </div>
      <ion-button fill="clear" (click)="goToActiveBooking()">
        <ion-icon name="arrow-forward"></ion-icon>
      </ion-button>
    </div>
  </div>

  <!-- Parking Spaces List -->
  <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <div *ngIf="isLoading" class="spinner">
    <ion-spinner></ion-spinner>
  </div>

  <div *ngIf="!isLoading && parkingSpaces.length === 0" class="empty-state">
    <ion-icon name="location-outline"></ion-icon>
    <p>No parking spaces available in your area</p>
  </div>

  <ion-card 
    *ngFor="let space of parkingSpaces" 
    (click)="viewParkingDetails(space)"
    class="parking-card"
  >
    <ion-img [src]="space.image"></ion-img>
    
    <ion-card-content>
      <div class="flex-between mb-md">
        <div>
          <h2>{{ space.title }}</h2>
          <p class="text-small text-muted">{{ space.area }}</p>
        </div>
        <div class="rating-badge">
          <ion-icon name="star"></ion-icon>
          {{ space.rating }}
        </div>
      </div>

      <p class="text-small">{{ space.address }}</p>

      <div class="amenities mt-md">
        <span *ngIf="space.has_security_camera" class="amenity-tag">
          <ion-icon name="camera"></ion-icon> Security
        </span>
        <span *ngIf="space.has_lighting" class="amenity-tag">
          <ion-icon name="bulb"></ion-icon> Lighting
        </span>
        <span *ngIf="space.has_ev_charging" class="amenity-tag">
          <ion-icon name="bolt"></ion-icon> EV
        </span>
      </div>

      <div class="flex-between mt-md pt-md" style="border-top: 1px solid #eee;">
        <div>
          <p class="text-small text-muted">From</p>
          <h3 class="price">â‚¹{{ space.price_per_day }}/day</h3>
        </div>
        <div class="text-right">
          <p class="text-small text-muted">Available</p>
          <p class="text-small"><strong>{{ space.available_spaces }}/{{ space.total_spaces }}</strong></p>
        </div>
      </div>
    </ion-card-content>
  </ion-card>
</ion-content>